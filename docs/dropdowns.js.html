<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>dropdowns.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_deviceInfo.html">lib/deviceInfo</a><ul class='methods'><li data-type='method'><a href="module-lib_deviceInfo.html#.getViewportWidth">getViewportWidth</a></li><li data-type='method'><a href="module-lib_deviceInfo.html#.init">init</a></li><li data-type='method'><a href="module-lib_deviceInfo.html#.isTouchDevice">isTouchDevice</a></li><li data-type='method'><a href="module-lib_deviceInfo.html#~onResize">onResize</a></li></ul></li><li><a href="module-lib_dropdowns.html">lib/dropdowns</a><ul class='methods'><li data-type='method'><a href="module-lib_dropdowns.html#.closeDropdowns">closeDropdowns</a></li><li data-type='method'><a href="module-lib_dropdowns.html#.init">init</a></li><li data-type='method'><a href="module-lib_dropdowns.html#.keepInViewport">keepInViewport</a></li><li data-type='method'><a href="module-lib_dropdowns.html#~parseOptions">parseOptions</a></li><li data-type='method'><a href="module-lib_dropdowns.html#~toggleDropdown">toggleDropdown</a></li></ul></li><li><a href="module-lib_floatLabel.html">lib/floatLabel</a><ul class='methods'><li data-type='method'><a href="module-lib_floatLabel.html#.init">init</a></li><li data-type='method'><a href="module-lib_floatLabel.html#~evaluateAllFields">evaluateAllFields</a></li><li data-type='method'><a href="module-lib_floatLabel.html#~evaluateContent">evaluateContent</a></li><li data-type='method'><a href="module-lib_floatLabel.html#~parseOptions">parseOptions</a></li></ul></li><li><a href="module-lib_modals.html">lib/modals</a><ul class='methods'><li data-type='method'><a href="module-lib_modals.html#.closeAllModals">closeAllModals</a></li><li data-type='method'><a href="module-lib_modals.html#.closeModal">closeModal</a></li><li data-type='method'><a href="module-lib_modals.html#.init">init</a></li><li data-type='method'><a href="module-lib_modals.html#.isAnyModalOpen">isAnyModalOpen</a></li><li data-type='method'><a href="module-lib_modals.html#.openModal">openModal</a></li><li data-type='method'><a href="module-lib_modals.html#.toggleModal">toggleModal</a></li><li data-type='method'><a href="module-lib_modals.html#~closerClick">closerClick</a></li><li data-type='method'><a href="module-lib_modals.html#~getClassFriendlyName">getClassFriendlyName</a></li><li data-type='method'><a href="module-lib_modals.html#~initializeOpenAttributes">initializeOpenAttributes</a></li><li data-type='method'><a href="module-lib_modals.html#~openerClick">openerClick</a></li><li data-type='method'><a href="module-lib_modals.html#~parseOptions">parseOptions</a></li><li data-type='method'><a href="module-lib_modals.html#~togglerClick">togglerClick</a></li></ul></li><li><a href="module-lib_optimizedEvents.html">lib/optimizedEvents</a></li><li><a href="module-lib_smoothScroll.html">lib/smoothScroll</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">dropdowns.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * DROPDOWNS:
 * Uses data attributes to suggest whether a dropdown should be open or closed.
 * NOTE: This doesn't change any visual style itself. You have to use CSS
 * to implement the hiding of the dropdown. A basic version of this is
 * implemented in the `.basic-dropdown` class (_basic-dropdown.scss).
 * Examples of usage can be seen in tests or readme.md
 *
 * Extra behaviour:
 * - If the user clicks outside of the dropdown, it closes automatically if data-close-on-outside-click is true.
 * - The dropdown content is kept in viewport automatically if the `data-keep-in-view` attribute is present.
 *
 * @module lib/dropdowns
 */

import { getViewportWidth } from './deviceInfo';

let togglerAttribute;
let keepInViewAttribute;
let containerAttribute;
let contentAttribute;
let closeOnOutsideAttribute;
let $dropdownTogglers;
let $keptInViewOpeners;
let $dropdowns;

/**
 * Adds event listeners
 * @param {object} [options]
 * @param {string} [options.togglerAttribute] - Attr. for child elements that toggle the dropdown on click
 * @param {string} [options.keepInViewAttribute] - Attr. that determines whether the dropdown is kept in viewport automatically
 * @param {string} [options.containerAttribute] - Attr. for the containing element that keeps track of whether or not the dropdown is open
 * @param {string} [options.contentAttribute] - Attr. marking the visible content of the dropdown
 * @param {string} [options.closeOnOutsideAttribute] - Attr. that determines whether the dropdown should close when mouseclick happens on the outside
 */
export function init(options = {}) {
  parseOptions(options);

  $dropdownTogglers = $(`[${togglerAttribute}]`);
  $keptInViewOpeners = $(`[${containerAttribute}][${keepInViewAttribute}]`);
  $dropdowns = $(`[${contentAttribute}]`);

  $dropdowns.on('click', evt => evt.stopPropagation());

  $dropdownTogglers.on('click', evt => {
    evt.stopPropagation();
    const $opener = $(evt.target);
    toggleDropdown($opener.closest(`[${containerAttribute}]`));
  });

  $(window).on('click', closeDropdowns);

  if ($keptInViewOpeners.length > 0) {
    keepInViewport();
    window.addEventListener('optimizedResize', keepInViewport);
  }
}

/**
 * Sets variables based on options object, or defaults. This should only be called from init.
 * @param {object} [options]
 */
function parseOptions(options) {
  togglerAttribute = options.togglerAttribute || 'data-dropdown-toggler';
  keepInViewAttribute = options.keepInViewAttribute || 'data-keep-in-view';
  containerAttribute = options.containerAttribute || 'data-dropdown-open';
  contentAttribute = options.contentAttribute || 'data-dropdown';
  closeOnOutsideAttribute = options.closeOnOutsideAttribute || 'data-close-on-outside-click';
}

/**
 * Toggles the dropdown by changing the container attribute's value to true/false
 * @param  {object} $dropdown   jQuery object corresponding to the dropdown container
 */
function toggleDropdown($dropdown) {
  if ($dropdown.attr(containerAttribute) === 'false') {
    $dropdown.attr(containerAttribute, 'true');
    keepInViewport();
  } else {
    $dropdown.attr(containerAttribute, 'false');
  }
}

/**
 * Keeps all the dropdowns in view that have the keepInViewAttribute
 */
export function keepInViewport() {
  const viewportWidth = getViewportWidth();

  for (let i = 0, len = $keptInViewOpeners.length; i &lt; len; i++) {
    const $opener = $keptInViewOpeners.eq(i);
    const $dropdown = $opener.find(`[${contentAttribute}]`);
    const openerWidth = $opener.width();
    const openerCenter = $opener.offset().left + (openerWidth / 2);
    const dropdownWidth = $dropdown.width();
    const dropdownWidthHalf = dropdownWidth / 2;

    if (openerCenter + dropdownWidthHalf > viewportWidth) { // If dropdown would go past screen to the right
      $dropdown.css({
        transform: `translate(${viewportWidth - (openerCenter + dropdownWidthHalf) - dropdownWidthHalf}px, 20px)`
      });
    } else if (openerCenter - dropdownWidthHalf &lt; 0) { // If dropdown would go past screen to the left
      $dropdown.css({
        transform: `translate(${-openerCenter}px, 20px)`
      });
    } else {
      $dropdown.css({
        transform: ``
      });
    }
  }
}

/**
 * Closes all the dropdowns that have the closeOnOutsideAttribute
 */
export function closeDropdowns() {
  $(`[${containerAttribute}][${closeOnOutsideAttribute}]`).attr('data-dropdown-open', 'false');
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Thu Oct 13 2016 12:10:54 GMT+0300 (EEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
